# P-R001: Implementation Plan for R001

## Requirement Reference
[R001: Kids Memory Game Core Features](../requirements/R001.md)

## Objective
Implement a complete kids memory matching game in Godot 4.3 for mobile, featuring main menu navigation, configurable game board, Singapore landmark-themed cards, and persistent settings.

## Proposed Approach

### Architecture
Use Godot's scene system with three main scenes:
1. **MainMenu.tscn** - Entry point with navigation buttons
2. **GameScene.tscn** - Memory game board with tile grid
3. **SettingsScene.tscn** - Configuration interface (placeholder + tile count setting)

### Scene Transitions
- Implement SceneManager singleton (autoload) for scene switching
- Use fade transitions between scenes for smooth UX

### Game Logic
- **Tile** script: Handle flip animations, state management (face-up/face-down/matched)
- **GameBoard** script: Grid layout, tile generation, match detection, game state
- **Timer** system: 5-second delay for non-matching tiles to flip back
- **Settings** persistence: Use Godot's ConfigFile to save/load tile count preference

### Asset Management
- Download 12 Singapore landmark images from Unsplash
- Create card back design (simple, kid-friendly pattern)
- Organize in `res://assets/images/` directory

## Implementation Steps

### 1. Project Structure Setup
1. Create folder structure:
   - `res://scenes/` (MainMenu, GameScene, SettingsScene)
   - `res://scripts/` (game logic scripts)
   - `res://assets/images/landmarks/` (Singapore images)
   - `res://assets/images/ui/` (card back, buttons, backgrounds)
   - `res://assets/fonts/` (kid-friendly font)

### 2. Download and Prepare Assets
1. Download 12 Singapore landmark images from Unsplash:
   - Marina Bay Sands
   - Merlion
   - Gardens by the Bay (Supertree Grove)
   - Singapore Flyer
   - Esplanade
   - ArtScience Museum
   - Sentosa
   - Chinatown
   - Little India
   - Raffles Hotel
   - Orchard Road
   - Jewel Changi Airport
2. Resize/optimize images for mobile (512x512px recommended)
3. Create card back image design
4. Find/create kid-friendly font

### 3. Create Autoload Singleton
1. Create `scripts/SceneManager.gd`:
   - Functions: `change_scene(scene_path)`, `fade_transition()`
   - Scene path constants
2. Create `scripts/GameSettings.gd`:
   - Load/save tile count using ConfigFile
   - Default tile count: 8
   - Supported values: 8, 12, 16, 24

### 4. Implement Main Menu Scene
1. Create `scenes/MainMenu.tscn`:
   - Background (colorful, kid-friendly)
   - Title label "Kids Memory Game"
   - Three buttons: New Game, Settings, Exit
2. Create `scripts/MainMenu.gd`:
   - Connect button signals
   - New Game → transition to GameScene
   - Settings → transition to SettingsScene
   - Exit → `get_tree().quit()`

### 5. Implement Settings Scene
1. Create `scenes/SettingsScene.tscn`:
   - Background
   - Title "Settings"
   - Tile count selector (OptionButton or buttons for 8, 12, 16, 24)
   - Back button → return to MainMenu
2. Create `scripts/SettingsScene.gd`:
   - Load current tile count from GameSettings
   - Update tile count on selection
   - Save to ConfigFile

### 6. Implement Tile System
1. Create `scenes/Tile.tscn`:
   - TextureButton or Control with TextureRect
   - AnimationPlayer for flip animation
   - Front and back textures
2. Create `scripts/Tile.gd`:
   - Properties: `id`, `is_flipped`, `is_matched`, `front_texture`, `back_texture`
   - Functions: `flip()`, `flip_back()`, `set_matched()`
   - Signal: `tile_clicked(tile)`

### 7. Implement Game Board
1. Create `scenes/GameScene.tscn`:
   - Background
   - GridContainer for tiles
   - UI layer with back button, move counter (optional)
   - Victory panel (hidden by default) with "Complete!" message
2. Create `scripts/GameBoard.gd`:
   - Load tile count from GameSettings
   - Generate tile grid (randomize positions)
   - Track game state: `first_tile`, `second_tile`, `pairs_found`
   - Handle tile clicks:
     - If 0 tiles flipped: flip first tile
     - If 1 tile flipped: flip second tile, check match
     - If match: mark both as matched, increment `pairs_found`
     - If not match: start 5-second timer, flip both back
     - If all pairs found: show "Complete!" message
   - Functions: `setup_board()`, `on_tile_clicked()`, `check_match()`, `check_win_condition()`

### 8. Implement Win Condition
1. Add victory UI to GameScene:
   - Panel/ColorRect overlay
   - Label "Complete!" with celebration styling
   - Button "Play Again" → reset board
   - Button "Main Menu" → return to menu
2. Update GameBoard.gd:
   - `show_victory_screen()` when `pairs_found == total_pairs`

### 9. Testing & Polish
1. Test all scene transitions
2. Test tile matching logic with all tile counts (8, 12, 16, 24)
3. Verify settings persistence across sessions
4. Test on mobile device/emulator for touch responsiveness
5. Add sound effects (optional for this phase)

## Files to be Modified/Created

### Created Files
- `scenes/MainMenu.tscn` - Main menu UI
- `scenes/GameScene.tscn` - Game board scene
- `scenes/SettingsScene.tscn` - Settings UI
- `scenes/Tile.tscn` - Individual tile component
- `scripts/MainMenu.gd` - Main menu logic
- `scripts/GameBoard.gd` - Game logic and board management
- `scripts/SettingsScene.gd` - Settings management
- `scripts/Tile.gd` - Tile behavior and animations
- `scripts/SceneManager.gd` - Scene transition singleton (autoload)
- `scripts/GameSettings.gd` - Settings persistence singleton (autoload)
- `assets/images/landmarks/[12 images].jpg` - Singapore landmark images
- `assets/images/ui/card_back.png` - Card back design
- `assets/fonts/kid_friendly.ttf` - Font file

### Modified Files
- `project.godot` - Add SceneManager and GameSettings to autoload
- `project.godot` - Set MainMenu as main scene

## Technical Considerations

### Performance
- Use texture atlases for tiles to reduce draw calls
- Limit tile animations to optimize for mobile
- Use compressed textures (VRAM compression enabled)

### Mobile Optimization
- Ensure touch targets are at least 48x48 pixels
- Use mobile-optimized rendering (already configured)
- Test on various screen sizes/aspect ratios
- Consider safe areas for notches

### Code Architecture
- Use signals for loose coupling between components
- Singleton pattern for global state (SceneManager, GameSettings)
- Scene instancing for tile creation (efficient memory use)

### Asset Considerations
- Use Unsplash API or manual download with proper attribution
- Ensure images are royalty-free for commercial use
- Optimize image sizes (target ~200KB per image for mobile)

### Settings Persistence
- ConfigFile stored at `user://settings.cfg`
- Handle missing config gracefully (use defaults)

## Clarification Needed
- None - All architectural decisions have been confirmed

## Risks and Mitigation

### Risk 1: Image Download/License Issues
- **Mitigation**: Use Unsplash's free license images, include attribution in credits, verify license compatibility

### Risk 2: Performance on Lower-End Mobile Devices
- **Mitigation**: Start with 8 tiles default, optimize textures, profile on target devices, implement quality settings if needed

### Risk 3: Touch Detection Issues
- **Mitigation**: Use Godot's built-in touch input system, adequate touch target sizes, test on actual mobile devices

### Risk 4: Scene Transition Smoothness
- **Mitigation**: Use simple fade transitions, preload scenes if needed, test on target hardware

### Risk 5: Settings Not Persisting
- **Mitigation**: Thoroughly test ConfigFile save/load, add error handling, provide fallback to defaults

## Estimated Effort
- Asset preparation: 1-2 hours
- Scene structure and UI: 2-3 hours
- Game logic implementation: 3-4 hours
- Testing and polish: 1-2 hours
- **Total: 7-11 hours**

---
**Status**: Implemented  
**Created**: 2024-12-24  
**Last Updated**: 2024-12-24  
**Approved By**: User
