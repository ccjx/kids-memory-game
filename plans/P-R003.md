# P-R003: Implementation Plan for R003

## Requirement Reference
[R003: Animation POC for Victory and Wrong Match Effects](../requirements/R003.md)

## Objective
Create a proof-of-concept environment to showcase and test multiple animation options for victory screens and wrong match effects, allowing user to select preferred implementations.

## Proposed Approach

### POC Scene Architecture
- Create dedicated AnimationPOC scene accessible from main menu
- Split UI into two sections: Victory Animations and Wrong Match Animations
- Each section has 4 option buttons to trigger demos
- Include demo area to display animations
- Add "Replay" button for each option

### Victory Animation Implementation
Implement 4 distinct victory animations using different Godot techniques:
1. **Confetti Burst**: GPUParticles2D with varied colors, gravity, lifetime
2. **Star Cascade**: CPUParticles2D falling stars with shader shimmer on text
3. **Trophy Rise**: Tween-based elastic animation with rotating sprite rays
4. **Fireworks Display**: Multiple timed particle emitters with explosions

### Wrong Match Animation Implementation
Implement 4 distinct error feedback animations:
1. **Shake + Red Flash**: Tween shake + ColorRect flash + camera shake
2. **Bounce Back**: Spring physics simulation + sprite overlay (X symbols)
3. **Wobble + Dim**: Rotation tween + modulate color change + outline pulse
4. **Electric Spark**: Line2D animated path + flash effects

### Demo Flow
- User clicks option button → animation plays in demo area
- Demo tiles/victory panel appear in preview area
- Animation completes and can be replayed
- Clear visual separation between options

## Implementation Steps

### 1. Create AnimationPOC Scene Structure
1. Create `scenes/AnimationPOC.tscn`
2. Layout structure:
   ```
   - AnimationPOC (Control)
     - Background (ColorRect)
     - VBoxContainer
       - TitleLabel ("Animation POC")
       - HBoxContainer (Main content)
         - VictorySection (VBoxContainer)
           - SectionLabel ("Victory Animations")
           - OptionButtons (1-4)
           - DemoArea (Panel)
         - WrongMatchSection (VBoxContainer)
           - SectionLabel ("Wrong Match Animations")
           - OptionButtons (1-4)
           - DemoArea (Panel with 2 tiles)
       - BackButton
   ```

### 2. Create AnimationPOC Script
1. Create `scripts/AnimationPOC.gd`
2. Implement button handlers for each option
3. Create methods:
   - `play_victory_option(option_num: int)`
   - `play_wrong_match_option(option_num: int)`
   - `reset_demo_areas()`

### 3. Implement Victory Animation Option 1: Confetti Burst
1. Create `scenes/effects/ConfettiBurst.tscn` with GPUParticles2D
2. Configure particle properties:
   - Emission shape: Point
   - Initial velocity: radial outward
   - Colors: rainbow array
   - Gravity: (0, 980)
   - Lifetime: 2-3 seconds
3. Add "Complete!" label with scale bounce tween
4. Trigger: one_shot emission on play()

### 4. Implement Victory Animation Option 2: Star Cascade
1. Create `scenes/effects/StarCascade.tscn` with CPUParticles2D
2. Configure:
   - Emission: from top edge, across screen width
   - Direction: downward with slight randomness
   - Texture: star sprite
   - Color gradient: gold to white
3. Add shimmer shader to "Complete!" text (optional: simple ColorRect animation)
4. Background pulse: animate ColorRect modulate

### 5. Implement Victory Animation Option 3: Trophy Rise
1. Create `scenes/effects/TrophyRise.tscn`
2. Components:
   - Trophy sprite (can use emoji or simple icon)
   - Light rays (rotating Sprite2D or Line2D)
   - "Complete!" label
3. Animation sequence:
   - Trophy tweens from bottom to center (elastic easing)
   - Rays rotate continuously during rise
   - Text fades in after trophy settles
4. Use Tween with TRANS_ELASTIC, EASE_OUT

### 6. Implement Victory Animation Option 4: Fireworks Display
1. Create `scenes/effects/FireworksDisplay.tscn`
2. Multiple GPUParticles2D nodes:
   - 3-5 emitters at random positions
   - Each has trail particles (small) + explosion (large burst)
   - Varied colors per emitter
   - Timed sequence (0s, 0.5s, 1s, 1.5s delays)
3. "Complete!" appears with typewriter effect:
   - Reveal characters one by one using visible_characters property
   - Or use RichTextLabel with BBCode effects

### 7. Implement Wrong Match Animation Option 1: Shake + Red Flash
1. Create shake animation method:
   - Tween tile position.x ± 5 pixels, 4 cycles in 0.3s
   - Use TRANS_SINE for smooth oscillation
2. Add ColorRect overlay with red color (modulate alpha 0 → 0.5 → 0)
3. Optional camera shake: offset main canvas slightly
4. Sequence: shake → flash → shake → flash (2 cycles, 500ms total)

### 8. Implement Wrong Match Animation Option 2: Bounce Back
1. Create spring-like backward movement:
   - Tween tiles away from each other (-20 pixels)
   - Elastic easing back to original position
2. Create "X" sprite or TextureRect
3. Show X above each tile during bounce
4. Sequence: bounce out → show X → bounce back → hide X

### 9. Implement Wrong Match Animation Option 3: Wobble + Dim
1. Rotation wobble:
   - Tween rotation_degrees ± 10°, 2 cycles
   - Use TRANS_SINE
2. Dim effect:
   - Tween modulate to Color(0.5, 0.3, 0.3) and back
3. Outline pulse:
   - Animate Panel border alpha 0 → 1 → 0, synchronized with wobble
4. All effects run simultaneously

### 10. Implement Wrong Match Animation Option 4: Electric Spark
1. Create Line2D between two tiles
2. Animate points to create zigzag path:
   - Random offset points between tiles
   - Animate visible amount 0 → 1 quickly
   - Flash white then red
3. Screen flash: brief white ColorRect overlay
4. Sequence: draw spark → flash screen → fade out

### 11. Add to Main Menu
1. Update `scenes/MainMenu.tscn` to add "Animation POC" button
2. Update `scripts/MainMenu.gd`:
   ```gdscript
   @onready var animation_poc_button: Button = $VBoxContainer/AnimationPOCButton
   
   func _ready():
       # ... existing connections
       animation_poc_button.pressed.connect(_on_animation_poc_pressed)
   
   func _on_animation_poc_pressed():
       SceneManager.change_scene(SceneManager.ANIMATION_POC)
   ```
3. Add ANIMATION_POC constant to SceneManager.gd

### 12. Polish and Testing
1. Ensure all 8 options work independently
2. Add replay functionality for each option
3. Verify animations loop or reset properly
4. Test performance of particle-heavy options
5. Add labels/descriptions for each option
6. Ensure smooth 60 FPS on all animations

## Files to be Modified/Created

### Created Files
- `scenes/AnimationPOC.tscn` - Main POC scene
- `scripts/AnimationPOC.gd` - POC logic
- `scenes/effects/ConfettiBurst.tscn` - Victory option 1
- `scenes/effects/StarCascade.tscn` - Victory option 2
- `scenes/effects/TrophyRise.tscn` - Victory option 3
- `scenes/effects/FireworksDisplay.tscn` - Victory option 4
- May create additional effect scenes for wrong match options

### Modified Files
- `scripts/SceneManager.gd` - Add ANIMATION_POC scene constant
- `scenes/MainMenu.tscn` - Add Animation POC button
- `scripts/MainMenu.gd` - Add button connection

## Technical Considerations

### Performance
- Particle systems can be GPU-intensive - use CPU particles for mobile if needed
- Limit particle count for wrong match animations (they play frequently)
- Test on target mobile devices
- Consider providing quality toggles for POC

### Animation Design
- Keep victory animations celebratory but not too long (2-3 seconds max)
- Wrong match animations should be brief (<0.5s) to maintain game flow
- Ensure animations are visually distinct from each other
- Consider colorblind-friendly options (not just red for errors)

### Code Organization
- Keep effect scenes modular and reusable
- Use signals to notify when animations complete
- Separate animation logic from POC UI logic
- Document which Godot features each option uses

### Mobile Considerations
- Particle effects should scale with screen size
- Touch targets for buttons should be adequate
- Test on actual iPad Mini if available
- Consider battery/performance impact of heavy effects

## Clarification Needed
- None - this is a POC with flexibility to iterate

## Risks and Mitigation

### Risk 1: Particle Effects Too Heavy for Mobile
- **Mitigation**: Use CPUParticles2D, reduce particle counts, provide fallback simple animations

### Risk 2: Animations Not Visually Distinct Enough
- **Mitigation**: Use very different techniques/styles, get early feedback, iterate quickly

### Risk 3: POC Takes Too Long to Implement
- **Mitigation**: Start with 2 options per category, add more if time permits, prioritize variety

### Risk 4: Shader Effects Not Supported on All Devices
- **Mitigation**: Keep shaders optional, provide non-shader alternatives, test compatibility

## Estimated Effort
- POC scene structure: 1 hour
- Victory animations (4 options): 4-6 hours
- Wrong match animations (4 options): 3-4 hours
- Integration with main menu: 0.5 hours
- Testing and polish: 1-2 hours
- **Total: 9.5-13.5 hours**

---
**Status**: Implemented  
**Created**: 2024-12-24  
**Last Updated**: 2024-12-24  
**Approved By**: User
